<!DOCTYPE html>
<html lang="es">
<head>
  <title>2048</title>
  <style>
    body {
      background-color: #b1b1b1;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }

    #contenedor {
      border-radius: 15px;
      padding: 5px;
      display: grid;
      background-color: grey;
      grid-template-columns: repeat(4, 1fr);
      gap: 5px;
      width: 500px;
      height: 500px;
    }

    .casilla {
      color: white;
      border-radius: 15px;
      min-width: calc(25% - 5px);
      min-height: calc(25% - 5px);
      max-width: 121.5px;
      max-height: 121.5px;
      text-align: center;
      background-color: #202020;
      border: 1px solid #202020;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

  </style>
</head>

<body>
  <div id="contenedor">
    <div class="casilla"><span id="1"></span></div>
    <div class="casilla"><span id="2"></span></div>
    <div class="casilla"><span id="3"></span></div>
    <div class="casilla"><span id="4"></span></div>
    <div class="casilla"><span id="5"></span></div>
    <div class="casilla"><span id="6"></span></div>
    <div class="casilla"><span id="7"></span></div>
    <div class="casilla"><span id="8"></span></div>
    <div class="casilla"><span id="9"></span></div>
    <div class="casilla"><span id="10"></span></div>
    <div class="casilla"><span id="11"></span></div>
    <div class="casilla"><span id="12"></span></div>
    <div class="casilla"><span id="13"></span></div>
    <div class="casilla"><span id="14"></span></div>
    <div class="casilla"><span id="15"></span></div>
    <div class="casilla"><span id="16"></span></div>
  </div>

</body>
<script>
  var numeros = Array(16).fill(null);
  var numerosAnteriores;

  document.addEventListener("DOMContentLoaded", function () {
    // Tu código aquí se ejecutará después de que se cargue el DOM
    generacionDeNumeros(); generacionDeNumeros();
  });
  document.addEventListener('keydown', function (event) {
    // Capturar la tecla presionada y su código
    const codigoTecla = event.keyCode;
    //console.log(codigoTecla);
    if (codigoTecla >= 37 && codigoTecla <= 40) {
      numerosAnteriores = numeros.slice();
      movimientoDeCasillas(codigoTecla);
      var alMenosUnoValido = numeros.some(function (valor) {
        return valor == null;
      });
      if (alMenosUnoValido) {
        if (!sonIguales(numeros, numerosAnteriores)) {
          generacionDeNumeros();
        }
      } else {
        alert('El juego se acabó');
      }
    }
    // Mostrar información en la consola
  });

  function generacionDeNumeros() {
    do {
      var numeroAleatorio = Math.floor(Math.random() * 16) + 1;
      var comprobante = false;
      if (!comprobarVacio(numeroAleatorio)) {
        var numIni = dosOCuatro();
        document.getElementById(numeroAleatorio).textContent = numIni;
        numeros[numeroAleatorio - 1] = numIni;
        comprobante = true;
      }
    } while (!comprobante);
  }

  function comprobarVacio(casilla) {
    if (numeros[casilla - 1] != null) {
      return true;
    }
    return false;
  }
  function dosOCuatro() {
    var probabilidad = Math.random();

    if (probabilidad < 0.1) {
      return 4; // 20% de probabilidad para 4
    } else {
      return 2; // 80% de probabilidad para 2
    }
  }

  function movimientoDeCasillas(codigoTecla) {
    switch (codigoTecla) {
      case 37:
        derechaAIzquierda();
        break;
      case 38:
        abajoAArriba();
        break;
      case 39:
        izquierdaADerecha();
        break;
      case 40:
        //aparentemente acabado el movimiento hacia abajo
        arribaAAbajo();
        break;
    }
    //repintar();
  }

  function arribaAAbajo() {
    desplazarArribaAAbajo();
    sumaDeArribaAAbajo();
    desplazarArribaAAbajo();
  }

  function desplazarArribaAAbajo() {
    //esto ya no se necesita
    /*for (var i = 11; i >=0 ; i--) {
      if(numeros[i]!=null){
        if (numeros[i + 4]==null) {
          numeros[i+4] = numeros[i];
          document.getElementById(i+1).textContent = "";
          document.getElementById(i+5).textContent = numeros[i];
          numeros[i] = null;
        }
      }
    }*/
    for (var i = 11; i >= 0; i--) {
      if (numeros[i] != null) {
        var j;
        for (j = 4; j <= 16; j += 4) {
          if (numeros[i + j] != null || 1 + i + j > numeros.length) {
            j -= 4;
            break;
          }
        }
        //console.log(j);
        if (j >= 4) {
          numeros[i + j] = numeros[i];
          document.getElementById(i + 1).textContent = "";
          document.getElementById(i + j + 1).textContent = numeros[i];
          numeros[i] = null;
        } /*else if (numeros[i + 4] == null) {
          numeros[i + 4] = numeros[i];
          document.getElementById(i + 1).textContent = "";
          document.getElementById(i + 5).textContent = numeros[i];
          numeros[i] = null;
        }*/
      }
    }
  }

  function sumaDeArribaAAbajo() {
    for (var i = 16; i > 4; i--) {
      //en realizad es -4, pero como siempre es un numero menos dentro de un array se le resta 5
      //hay que cambiar y poner que no puede ser nulo el campo en el siguiente if
      if ((numeros[i - 1] == numeros[i - 5]) && numeros[i - 1] != null) {
        numeros[i - 1] += numeros[i - 1];
        numeros[i - 5] = null;
      }
    }
    repintar(numeros);
  }

  function abajoAArriba() {
    desplazarAbajoAArriba();
    sumaDeAbajoAArriba();
    desplazarAbajoAArriba();
  }

  function desplazarAbajoAArriba() {
    //esto ya no se necesita
    /*for (var i = 11; i >=0 ; i--) {
      if(numeros[i]!=null){
        if (numeros[i + 4]==null) {
          numeros[i+4] = numeros[i];
          document.getElementById(i+1).textContent = "";
          document.getElementById(i+5).textContent = numeros[i];
          numeros[i] = null;
        }
      }
    }*/
    for (var i = 4; i < 16; i++) {
      if (numeros[i] != null) {
        var j;
        /*for (j = 4; j <= 16; j += 4) {
          if (numeros[i + j] != null || 1 + i + j > numeros.length) {
            j -= 4;
            break;
          }
        }*/
        for (j = 4; j >= 1; j += 4) {
          if (numeros[i - j] != null || 1 + i - j < 1) {
            j -= 4;
            break;
          }
        }
        //console.log(j);
        if (j >= 4) {
          numeros[i - j] = numeros[i];
          document.getElementById(i + 1).textContent = "";
          document.getElementById(i - j + 1).textContent = numeros[i];
          numeros[i] = null;
        }
      }
    }
  }

  function sumaDeAbajoAArriba() {
    for (var i = 1; i < 13; i++) {
      if ((numeros[i - 1] == numeros[i + 3]) && numeros[i - 1] != null) {
        numeros[i - 1] += numeros[i - 1];
        numeros[i + 3] = null;
      }
    }
    repintar(numeros);
  }

  function izquierdaADerecha() {
    desplazarIzquierdaADerecha();
    //sumaDeIzquierdaADerecha();
    //desplazarIzquierdaADerecha();
  }

  function desplazarIzquierdaADerecha() {
    //esto ya no se necesita
    /*for (var i = 11; i >=0 ; i--) {
      if(numeros[i]!=null){
        if (numeros[i + 4]==null) {
          numeros[i+4] = numeros[i];
          document.getElementById(i+1).textContent = "";
          document.getElementById(i+5).textContent = numeros[i];
          numeros[i] = null;
        }
      }
    }*/
    for (var i = 11; i >= 0; i--) {
      if (numeros[i] != null) {
        var j;
        for (j = 4; j <= 16; j += 4) {
          if (numeros[i + j] != null || 1 + i + j > numeros.length) {
            j -= 4;
            break;
          }
        }
        //console.log(j);
        if (j >= 4) {
          numeros[i + j] = numeros[i];
          document.getElementById(i + 1).textContent = "";
          document.getElementById(i + j + 1).textContent = numeros[i];
          numeros[i] = null;
        } /*else if (numeros[i + 4] == null) {
          numeros[i + 4] = numeros[i];
          document.getElementById(i + 1).textContent = "";
          document.getElementById(i + 5).textContent = numeros[i];
          numeros[i] = null;
        }*/
      }
    }
  }

  function sumaDeIzquierdaADerecha() {
    for (var i = 16; i > 4; i--) {
      //en realizad es -4, pero como siempre es un numero menos dentro de un array se le resta 5
      //hay que cambiar y poner que no puede ser nulo el campo en el siguiente if
      if ((numeros[i - 1] == numeros[i - 5]) && numeros[i - 1] != null) {
        numeros[i - 1] += numeros[i - 1];
        numeros[i - 5] = null;
      }
    }
    repintar(numeros);
  }

  function derechaAIzquierda() {
    desplazarDerechaAIzquierda();
    //sumaDeDerechaAIzquierda();
    //desplazarDerechaAIzquierda();
  }

  function desplazarDerechaAIzquierda() {
    //esto ya no se necesita
    /*for (var i = 11; i >=0 ; i--) {
      if(numeros[i]!=null){
        if (numeros[i + 4]==null) {
          numeros[i+4] = numeros[i];
          document.getElementById(i+1).textContent = "";
          document.getElementById(i+5).textContent = numeros[i];
          numeros[i] = null;
        }
      }
    }*/
    for (var i = 11; i >= 0; i--) {
      if (numeros[i] != null) {
        var j;
        for (j = 4; j <= 16; j += 4) {
          if (numeros[i + j] != null || 1 + i + j > numeros.length) {
            j -= 4;
            break;
          }
        }
        //console.log(j);
        if (j >= 4) {
          numeros[i + j] = numeros[i];
          document.getElementById(i + 1).textContent = "";
          document.getElementById(i + j + 1).textContent = numeros[i];
          numeros[i] = null;
        } /*else if (numeros[i + 4] == null) {
          numeros[i + 4] = numeros[i];
          document.getElementById(i + 1).textContent = "";
          document.getElementById(i + 5).textContent = numeros[i];
          numeros[i] = null;
        }*/
      }
    }
  }

  function sumaDeDerechaAIzquierda() {
    for (var i = 16; i > 4; i--) {
      //en realizad es -4, pero como siempre es un numero menos dentro de un array se le resta 5
      //hay que cambiar y poner que no puede ser nulo el campo en el siguiente if
      if ((numeros[i - 1] == numeros[i - 5]) && numeros[i - 1] != null) {
        numeros[i - 1] += numeros[i - 1];
        numeros[i - 5] = null;
      }
    }
    repintar(numeros);
  }

  function repintar(num) {
    for (var i = 1; i <= 16; i++) {
      document.getElementById(i).textContent = num[i - 1];
    }
  }

  /*var arrayBidimensional = Array.from({ length: 4 }, () => Array(4).fill(null));

  function conversionABidimensional(arr) {
    // Recorrer el array bidimensional con forEach
    var i = 0;
    arrayBidimensional.forEach((fila, indiceFila) => {
      fila.forEach((valor, indiceColumna) => {
        valor = arr[i];
        i++;
      });
    });
  }

  function desconversionDeBidimensional(arr) {

  }*/
  function sonIguales(array1, array2) {
    // Convertir los arrays a cadenas JSON y compararlas
    const strArray1 = JSON.stringify(array1);
    const strArray2 = JSON.stringify(array2);

    return strArray1 === strArray2;
  }
  //imaginate que tienes un array con 16 valores, e imaginate que están pintados de manera visual en una tabla de 4x4, y quieres hacer que los valores de la tabla giren 90º hacia la derecha de tal manera que el que esta en la celda 1,1 este en la celda 4,1 el de la 2,1 en la 4,2 etc
  function girarEnSentidoHorario() {
    const n = numeros.length;
    const result = new Array(n).fill(0).map(() => new Array(n).fill(0));

    for (let i = 0; i < n; i++) {
      for (let j = 0; j < n; j++) {
        result[j][n - 1 - i] = arr[i * n + j];
      }
    }

    return result;
  }

  function girarEnSentidoAntihorario() {

  }
</script>
</html>
